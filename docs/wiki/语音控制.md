# 语音控制

语音控制是 Ava 的核心功能，让你可以通过说话来控制智能家居设备。

---

## 工作原理

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   你说话     │ -> │  Ava 录音   │ -> │ Home Assistant│ -> │  Ava 播放   │
│  唤醒词+命令 │    │  发送音频   │    │   语音识别   │    │   语音回复  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
```

**详细流程：**

1. **待机状态**：Ava 持续监听唤醒词（本地处理，不联网）
2. **唤醒检测**：检测到唤醒词后，播放提示音，开始录音
3. **语音传输**：录音通过 ESPHome 协议发送到 Home Assistant
4. **语音识别**：Home Assistant 的语音助手进行语音转文字
5. **意图处理**：Home Assistant 理解你的意图并执行操作
6. **语音合成**：Home Assistant 生成语音回复
7. **播放回复**：Ava 接收并播放语音回复

---

## 唤醒词

唤醒词是触发语音识别的关键词。Ava 使用本地唤醒词检测，不需要联网。

### 支持的唤醒词

| 唤醒词 | 说明 |
|--------|------|
| Hey Jarvis | 默认唤醒词，钢铁侠风格 |
| Alexa | 亚马逊风格 |
| Hey Google | 谷歌风格 |
| OK Google | 谷歌风格 |
| Hey Mycroft | Mycroft 风格 |
| Hey Siri | 苹果风格（仅用于测试） |

### 如何更换唤醒词

1. 打开 Ava 应用
2. 进入 **设置** → **语音卫星**
3. 找到 **唤醒词** 选项
4. 从列表中选择你喜欢的唤醒词
5. 新唤醒词立即生效

### 唤醒词检测原理

Ava 使用 **microWakeWord** 技术进行本地唤醒词检测：

- 基于 TensorFlow Lite 模型
- 16kHz 采样率，16位音频
- 滑动窗口概率计算
- 完全本地处理，保护隐私

---

## 停止词

停止词用于打断当前对话或停止 Ava 的回复。

### 支持的停止词

| 停止词 | 说明 |
|--------|------|
| Stop | 默认停止词 |
| Never mind | 算了 |
| Cancel | 取消 |

### 使用场景

- Ava 正在播放很长的回复，你想打断它
- 你说错了，想重新开始
- 你改变主意了，不想执行命令

---

## 唤醒提示音

唤醒提示音是 Ava 开始录音时播放的声音，让你知道可以开始说话了。

### 设置选项

| 选项 | 说明 |
|------|------|
| 开启 | 播放提示音 |
| 关闭 | 静默开始录音 |
| 自定义 | 选择自己的提示音文件 |

### 如何设置

1. 进入 **设置** → **语音卫星**
2. 找到 **唤醒提示音** 选项
3. 选择开启/关闭，或选择自定义音频文件

---

## 静音模式

静音模式会关闭麦克风，Ava 不会响应任何唤醒词。

### 使用场景

- 开会时不想被打扰
- 看电影时避免误触发
- 临时禁用语音功能

### 如何开启

**方法一：设置中开启**
1. 进入 **设置** → **语音卫星**
2. 打开 **静音** 开关

**方法二：Home Assistant 控制**
```yaml
service: switch.turn_on
target:
  entity_id: switch.your_device_name_mute
```

---

## 连续对话

连续对话功能让你可以连续发出多个命令，无需每次都说唤醒词。

### 工作方式

1. 说出唤醒词 + 第一个命令
2. Ava 回复后，自动进入监听状态
3. 直接说下一个命令（无需唤醒词）
4. 几秒钟没有说话后，自动退出连续对话模式

### 如何开启

1. 进入 **设置** → **交互**
2. 打开 **连续对话** 开关

---

## 对话字幕

对话字幕功能会在屏幕上显示你说的话和 Ava 的回复。

### 显示内容

- **你说的话**：显示在屏幕上方
- **Ava 的回复**：显示在屏幕下方

### 如何开启

1. 进入 **设置** → **交互**
2. 打开 **对话字幕** 开关

---

## 设置汇总

| 设置项 | 位置 | 说明 | 默认值 |
|--------|------|------|--------|
| 设备名称 | 语音卫星 | 在 HA 中显示的名字 | 设备型号_voice_assistant |
| 端口 | 语音卫星 | ESPHome 通信端口 | 6053 |
| 唤醒词 | 语音卫星 | 触发语音识别的词 | Hey Jarvis |
| 停止词 | 语音卫星 | 打断对话的词 | Stop |
| 唤醒提示音 | 语音卫星 | 开始录音时的提示音 | 开启 |
| 静音 | 语音卫星 | 关闭麦克风 | 关闭 |
| 连续对话 | 交互 | 连续发出命令 | 关闭 |
| 对话字幕 | 交互 | 显示对话内容 | 关闭 |
| 音量 | 交互 | 回复音量 | 80% |

---

## Home Assistant 服务

### 手动触发唤醒

```yaml
service: esphome.your_device_name_trigger_wake
data: {}
```

### 控制静音

```yaml
# 开启静音
service: switch.turn_on
target:
  entity_id: switch.your_device_name_mute

# 关闭静音
service: switch.turn_off
target:
  entity_id: switch.your_device_name_mute
```

### 设置音量

```yaml
service: media_player.volume_set
target:
  entity_id: media_player.your_device_name
data:
  volume_level: 0.8  # 0.0 - 1.0
```

---

## 常见问题

### Ava 听不到我说话？

1. 检查麦克风权限是否已授予
2. 检查是否开启了静音模式
3. 确保设备音量不是静音
4. 尝试靠近设备说话

### 唤醒词识别不准确？

1. 尝试更换其他唤醒词
2. 确保环境不太嘈杂
3. 说话时语速适中，发音清晰

### 语音识别结果不对？

这通常是 Home Assistant 端的问题：
1. 检查 Home Assistant 的语音助手配置
2. 确保网络连接稳定
3. 尝试说得更清楚

---

*返回 [首页](Home.md)*
