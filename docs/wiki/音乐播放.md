# 音乐播放

Ava 可以作为 Home Assistant 的媒体播放器，播放音乐和语音。

---

## 概述

Ava 支持以下音频功能：
- 媒体播放（音乐、播客等）
- TTS 语音播报
- 唤醒提示音
- 计时器提示音

---

## 媒体播放器

### 实体类型

在 Home Assistant 中，Ava 会注册为媒体播放器实体：
- `media_player.your_device_name`

### 支持的操作

| 操作 | 说明 |
|------|------|
| 播放 | 播放媒体 |
| 暂停 | 暂停播放 |
| 停止 | 停止播放 |
| 音量调节 | 0-100% |
| 静音 | 开启/关闭静音 |

---

## 播放音乐

### 通过 Home Assistant 服务

```yaml
service: media_player.play_media
target:
  entity_id: media_player.your_device_name
data:
  media_content_id: "http://example.com/music.mp3"
  media_content_type: "music"
```

### 支持的格式

| 格式 | 说明 |
|------|------|
| MP3 | 最常用 |
| AAC | 苹果格式 |
| OGG | 开源格式 |
| WAV | 无损格式 |
| FLAC | 无损压缩 |

### 支持的来源

- HTTP/HTTPS URL
- 本地文件路径
- 流媒体 URL

---

## 黑胶唱片封面

播放音乐时，Ava 可以显示漂亮的黑胶唱片风格专辑封面。

### 效果预览

```
┌─────────────────────────────────────┐
│                                     │
│         ╭───────────────╮           │
│        ╱                 ╲          │
│       │    ┌───────┐     │          │
│       │    │ 专辑  │     │          │
│       │    │ 封面  │     │          │
│       │    └───────┘     │          │
│        ╲                 ╱          │
│         ╰───────────────╯           │
│                                     │
└─────────────────────────────────────┘
```

### 如何开启

1. 进入 **设置** → **交互**
2. 打开 **黑胶唱片封面** 开关

### 封面来源

Ava 会自动尝试获取专辑封面：

1. **媒体元数据**：从播放的媒体中提取
2. **网易云音乐**：自动匹配网易云封面
3. **自定义封面**：通过服务设置

### 设置封面

```yaml
service: esphome.your_device_name_media_cover
data:
  url: "http://example.com/cover.jpg"
```

---

## TTS 语音播报

### 通过 Home Assistant

```yaml
service: tts.speak
target:
  entity_id: media_player.your_device_name
data:
  message: "你好，欢迎回家"
```

### TTS 引擎

Ava 使用 Home Assistant 配置的 TTS 引擎，推荐：
- Piper（本地，速度快）
- Google TTS（在线，质量好）
- Azure TTS（在线，质量好）

---

## 音量控制

### 设置音量

```yaml
service: media_player.volume_set
target:
  entity_id: media_player.your_device_name
data:
  volume_level: 0.8  # 0.0 - 1.0
```

### 静音

```yaml
service: media_player.volume_mute
target:
  entity_id: media_player.your_device_name
data:
  is_volume_muted: true
```

### 在 Ava 中设置

1. 进入 **设置** → **交互**
2. 调整 **音量** 滑块

---

## 对话字幕

显示语音对话的文字内容。

### 显示内容

- **你说的话**：显示在屏幕上方
- **Ava 的回复**：显示在屏幕下方

### 如何开启

1. 进入 **设置** → **交互**
2. 打开 **对话字幕** 开关

---

## 设置汇总

| 设置项 | 位置 | 说明 | 默认值 |
|--------|------|------|--------|
| 音量 | 交互 | 媒体播放音量 | 80% |
| 静音 | 交互 | 静音开关 | 关闭 |
| 黑胶唱片封面 | 交互 | 显示专辑封面 | 开启 |
| 对话字幕 | 交互 | 显示对话文字 | 关闭 |

---

## Home Assistant 服务

### 播放媒体

```yaml
service: media_player.play_media
target:
  entity_id: media_player.your_device_name
data:
  media_content_id: "http://example.com/music.mp3"
  media_content_type: "music"
```

### 暂停

```yaml
service: media_player.media_pause
target:
  entity_id: media_player.your_device_name
```

### 继续播放

```yaml
service: media_player.media_play
target:
  entity_id: media_player.your_device_name
```

### 停止

```yaml
service: media_player.media_stop
target:
  entity_id: media_player.your_device_name
```

### 设置音量

```yaml
service: media_player.volume_set
target:
  entity_id: media_player.your_device_name
data:
  volume_level: 0.8
```

---

## 常见问题

### 音乐不播放？

1. 检查 URL 是否可访问
2. 检查音频格式是否支持
3. 检查音量是否静音
4. 检查 Home Assistant 连接

### 封面不显示？

1. 检查是否开启了黑胶唱片封面
2. 检查网络连接
3. 尝试手动设置封面 URL

### 音量太小？

1. 调高 Ava 中的音量设置
2. 调高设备系统音量
3. 检查是否开启了静音

---

*返回 [首页](Home.md)*
